<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>年金・保険・税金の計算</title>
    <link href="./res/default.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>
<body>
    <h1>個人事業主の税金計算（jquery版）</h1>
    <div id="page">
        <div id="app" class="flex" data-v-app=""><!----></div>
        <div id="render-1" class="flex">
            <div class="column">
                <table class="table border">
                    <thead>
                        <tr><th colspan="2" class="diagonal">入力用</th><th>月間(万円)</th><th>年間(万円)</th></tr>
                    </thead>
                    <tbody>
                        <tr><th colspan="2">収入</th><td class="amount" id="monthly-1-0"></td><td class="amount bold" id="yearly-1-0"></td></tr>
                        <tr><th rowspan="2"></th><td>売上</td><td class="amount income" id="monthly-1-1"></td><td class="amount" id="yearly-1-1"><input type="text" class="amount income" id="input-yearly-1-1" value="600"></td></tr>
                        <tr><td>売上（補正用）</td><td class="amount income" id="monthly-1-2"></td><td class="amount" id="yearly-1-2"><input type="text" class="amount income" id="input-yearly-1-2" value=""></td></tr>
                        <tr><th colspan="2">経費</th><td class="amount cost" id="monthly-2-0"></td><td class="amount cost bold" id="yearly-2-0"></td></tr>
                        <tr><th rowspan="2"></th><td>経費</td><td class="amount cost" id="monthly-2-1"></td><td class="amount" id="yearly-2-1"><input type="text" class="amount cost" id="input-yearly-2-1" value=""></td></tr>
                        <tr><td>経費（補正用）</td><td class="amount cost" id="monthly-2-2"></td><td class="amount" id="yearly-2-2"><input type="text" class="amount cost" id="input-yearly-2-2" value=""></td></tr>
                        <tr><th colspan="2">控除</th><td class="amount cost" id="monthly-3-0"></td><td class="amount cost bold" id="yearly-3-0"></td></tr>
                        <tr><th rowspan="10"></th><td>基礎控除</td><td class="amount cost" id="monthly-3-1"></td><td class="amount" id="yearly-3-1"><input type="text" class="amount cost" id="input-yearly-3-1" value="48"></td></tr>
                        <tr><td>青色申告控除</td><td class="amount cost" id="monthly-3-2"></td><td class="amount" id="yearly-3-2"><input type="text" class="amount cost" id="input-yearly-3-2" value="65"></td></tr>
                        <tr><td>社会保険料控除</td><td class="amount cost" id="monthly-3-3"></td><td class="amount" id="yearly-3-3"><input type="text" class="amount cost" id="input-yearly-3-3" value=""></td></tr>
                        <tr><td>小規模企業共済等掛金控除</td><td class="amount cost" id="monthly-3-4"></td><td class="amount" id="yearly-3-4"><input type="text" class="amount cost" id="input-yearly-3-4" value=""></td></tr>
                        <tr><td>生命保険料控除</td><td class="amount cost" id="monthly-3-5"></td><td class="amount" id="yearly-3-5"><input type="text" class="amount cost" id="input-yearly-3-5" value=""></td></tr>
                        <tr><td>地震保険料控除</td><td class="amount cost" id="monthly-3-6"></td><td class="amount" id="yearly-3-6"><input type="text" class="amount cost" id="input-yearly-3-6" value=""></td></tr>
                        <tr><td>配偶者控除・配偶者特別控除</td><td class="amount cost" id="monthly-3-7"></td><td class="amount" id="yearly-3-7"><input type="text" class="amount cost" id="input-yearly-3-7" value=""></td></tr>
                        <tr><td>扶養控除</td><td class="amount cost" id="monthly-3-8"></td><td class="amount" id="yearly-3-8"><input type="text" class="amount cost" id="input-yearly-3-8" value=""></td></tr>
                        <tr><td>医療費控除</td><td class="amount cost" id="monthly-3-9"></td><td class="amount" id="yearly-3-9"><input type="text" class="amount cost" id="input-yearly-3-9" value=""></td></tr>
                        <tr><td>控除（補正用）</td><td class="amount cost" id="monthly-3-10"></td><td class="amount" id="yearly-3-10"><input type="text" class="amount cost" id="input-yearly-3-10" value=""></td></tr>
                        <tr><th colspan="2">課税所得額</th><td></td class="amount" id="monthly-4-0"><td class="amount bold" id="yearly-4-0"></td></tr>
                        <tr><th rowspan="2"></th><td>※国民健康保険年間所得額</td><td class="amount" id="monthly-4-1"></td><td class="amount bold" id="yearly-4-1"></td></tr>
                        <tr><td>※課税所得額による所得税率</td><td class="amount" id="monthly-4-2"></td><td class="amount bold" id="yearly-4-2"></td></tr>
                    </tbody>
                </table>
            </div>

            <div class="column">
                <table class="table border">
                    <thead>
                        <tr><th colspan="2" class="diagonal">結果表示用</th><th>月間(万円)</th><th>年間(万円)</th></tr>
                    </thead>
                    <tbody>
                        <tr><th colspan="2">税金</th><td class="amount"></td><td class="amount bold" id="yearly-7-0"></td></tr>
                        <tr><th rowspan="6"></th><td>住民税・均等割</td><td class="amount" id="monthly-7-1"></td><td class="amount" id="yearly-7-1">0.5</td></tr>
                        <tr><td>住民税・所得割</td><td class="amount" id="monthly-7-2"></td><td class="amount" id="yearly-7-2"></td></tr>
                        <tr><td>個人事業税</td><td class="amount" id="monthly-7-3"></td><td class="amount" id="yearly-7-3"></td></tr>
                        <tr><td>所得税</td><td class="amount" id="monthly-7-4"></td><td class="amount" id="yearly-7-4"></td></tr>
                        <tr><td>消費税</td><td class="amount" id="monthly-7-5"></td><td class="amount" id="yearly-7-5"></td></tr>
                        <tr><td>税金（補正用）</td><td class="amount" id="monthly-7-6"></td><td class="amount" id="yearly-7-6"><input type="text" class="amount" id="input-yearly-7-6" value=""></td></tr>
                        <tr><th colspan="2">年金</th><td class="amount"></td><td class="amount bold" id="yearly-8-0"></td></tr>
                        <tr><th rowspan="2"></th><td>国民年金</td><td class="amount" id="monthly-8-1"></td><td class="amount" id="yearly-8-1"></td></tr>
                        <tr><td>年金（補正用）</td><td class="amount" id="monthly-8-2"></td><td class="amount" id="yearly-8-2"><input type="text" class="amount" id="input-yearly-8-2" value=""></td></tr>
                        <tr><th colspan="2">保険</th><td class="amount" id="monthly-9-0"></td><td class="amount bold" id="yearly-9-0"></td></tr>

                        <tr><th rowspan="4"></th><th rowspan="4">加入者年齢</th><td class="right"><input type="text" class="age" id="age-1" value=""></td><td class="right"><input type="text" class="age" id="age-2" value=""></td></tr>
                        <tr><td class="right"><input type="text" class="age" id="age-3" value=""></td><td class="right"><input type="text" class="age" id="age-4" value=""></td></tr>
                        <tr><td class="right"><input type="text" class="age" id="age-4" value=""></td><td class="right"><input type="text" class="age" id="age-6" value=""></td></tr>
                        <tr><td class="right"><input type="text" class="age" id="age-5" value=""></td><td class="right"><input type="text" class="age" id="age-8" value=""></td></tr>

                        <tr><th rowspan="6"></th><td>国民健康保険・平等割</td><td class="amount" id="monthly-9-1"></td><td id="yearly-9-1"></td></tr>
                        <tr><td>国民健康保険・均等割</td><td class="amount" id="monthly-9-2"></td><td class="amount" id="yearly-9-2"></td></tr>
                        <tr><td>国民健康保険・所得割</td><td class="amount" id="monthly-9-3"></td><td class="amount" id="yearly-9-3"></td></tr>
                        <tr><td>国民健康保険・後期高齢者(支援)</td><td class="amount" id="monthly-9-4"></td><td class="amount" id="yearly-9-4"></td></tr>
                        <tr><td>国民健康保険・後期高齢者(介護)</td><td class="amount" id="monthly-9-5"></td><td class="amount" id="yearly-9-5"></td></tr>
                        <tr><td>保険（補正用）</td><td class="amount" id="monthly-9-6"></td><td class="amount" id="yearly-9-6"><input type="text" class="amount" id="input-yearly-9-6" value=""></td></tr>
                        <tr><th colspan="2">概要</th><td></td><td></td></tr>
                        <tr><th rowspan="2"></th><td>合計支払額（年金・保険・税金）</td><td class="amount" id="monthly-10-1"></td><td class="amount bold" id="yearly-10-1"></td></tr>
                        <tr><td>手取り額（経費含む）</td><td class="amount" id="monthly-10-2"></td><td class="amount bold" id="yearly-10-2"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<script>
$(function(){
    tax.refresh();
    $(document).on("change", `input[type="text"].amount, input[type="text"].age`, function(){ tax.refresh($(this));});
});

var tax = tax || {
    refresh:($el)=>{
        let total_income = total_cost = total_allowable = total_amount = 0;
        $(`input[type="text"].amount`).get().forEach(function(text){
            $text = $(text);
            let css_id = $text.prop("id");
            let css_id_common = $text.prop("id").replace(/input-yearly-/, "");

            let amount = Number($text.val());
            let amount_monthly = (amount/12).toFixed(1);
            $(`#monthly-${css_id_common}`).text(amount ? amount_monthly : "");

            let plus_minuse = $text.hasClass("cost")? -1 : 1;

            // 合計収入
            total_income += $text.hasClass("income") ? plus_minuse*amount : 0;
            // 課税所得額
            total_amount += plus_minuse*amount;
            // 合計経費
            total_cost += css_id.match(/^input-yearly-2/) ? amount : 0;
            // 合計控除
            total_allowable += css_id.match(/^input-yearly-3/) ? amount : 0;
        });

        // 合計売上
        $(`#yearly-1-0`).text(total_income);
        // 合計経費
        $(`#yearly-2-0`).text(total_cost);
        // 合計控除
        $(`#yearly-3-0`).text(total_allowable);

        // 課税所得額
        $(`#yearly-4-0`).text(total_amount);
        // 国民健康保険年間所得額
        let insurance = total_amount-43;
        $(`#yearly-4-1`).text(insurance);
        // 課税所得額による所得税率
        let income_tax_rate = total_amount<=195 ? 5 : (total_amount <= 330 ? 10 : (total_amount <= 695 ? 20 : 24));
        $(`#yearly-4-2`).text(`${income_tax_rate}%`);

        let total_tax = 0;
        let tax_amount = 0;
        // 住民税・所得割
        tax_amount = total_amount/10;
        total_tax += Number(tax_amount);
        $(`#yearly-7-2`).text(tax_amount);
        // 個人事業税
        let freelance_tax = (total_amount>=290 ? (total_amount-290)*0.05 : 0).toFixed(1);
        total_tax += Number(freelance_tax);
        $(`#yearly-7-3`).text(freelance_tax);
        // 所得税
        tax_amount = (total_amount*income_tax_rate/100);
        total_tax += Number(tax_amount);
        $(`#yearly-7-4`).text(tax_amount);
        // 合計税金
        $(`#yearly-7-0`).text(total_tax);

        // 年金
        let total_pension = 0;
        // 国民年金
        tax_amount = (1.654*12).toFixed(1);
        total_pension += Number(tax_amount);
        $(`#yearly-8-1`).text(tax_amount);
        // 合計年金
        $(`#yearly-8-0`).text(total_pension);

        // 保険
        let total_insurance = 0;
        // 加入者情報
        let number_of_persons = 0;
        let number_of_under_40 = 0;
        let number_of_40_65 = 0;
        let number_of_66_75 = 0;
        let number_of_after_75 = 0;
        $(`input[type=text].age`).get().forEach(function(text){
            let $text = $(text);
            if ($text.val()==="") {
                return ;
            }

            number_of_persons += 1;
            if ($text.val()<40) {
                number_of_under_40 += 1;
            } else if ($text.val()<65) {
                number_of_40_65 += 1;
            } else if ($text.val()<75) {
                number_of_66_75 += 1;
            } else {
                number_of_after_75 += 1;
            }
        });

        console.log(number_of_persons);

        // 国民健康保険・均等割
        tax_amount = 4.5*4;
        total_insurance += Number(tax_amount);
        $(`#yearly-9-2`).text(tax_amount);
        // 国民健康保険・所得割
        tax_amount = (insurance*0.0717).toFixed(1);
        total_insurance += Number(tax_amount);
        $(`#yearly-9-3`).text(tax_amount);
        // 国民健康保険・後期高齢者(支援)
        tax_amount = (insurance*0.0242*number_of_40_65+1.5*number_of_persons).toFixed(1);
        total_insurance += Number(tax_amount);
        $(`#yearly-9-4`).text(tax_amount);
        // 国民健康保険・後期高齢者(介護)
        tax_amount = (insurance*0.0223+1.6*number_of_40_65).toFixed(1);
        total_insurance += Number(tax_amount);
        $(`#yearly-9-5`).text(tax_amount);
        // 合計保険
        $(`#yearly-9-0`).text(total_insurance.toFixed(1));

        // 概要
        // 合計
        let total_payment = (total_tax + total_pension + total_insurance).toFixed(1);
        $(`#yearly-10-1`).text(total_payment);
        let total_after_tax = (total_income-total_payment).toFixed(1);
        $(`#yearly-10-2`).text(total_after_tax);
    },
}
</script>
</html>