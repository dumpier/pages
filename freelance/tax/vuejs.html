<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>年金・保険・税金の計算</title>
    <link href="./res/default.css" rel="stylesheet">
    <script src="./res/config.js"></script>
	<script src="../../res/js/my.js"></script>
</head>

<body>
    <div id="app">
        <div class="loading" v-show="loading"><div class="loader"></div></div>
        <h1>個人事業主の税金計算(vue.js版)</h1>
        <span v-html="mode"></span>
        <!-- <div id="content" v-html="template"></div> -->
        <div id="content"><tax-table/></div>
    </div>
</body>


<script type="importmap">
{
    "imports": {
        "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
    }
}
</script>

<script type="module">
import { createApp, ref } from 'vue';

// apiの切り替え制御
const mode = {
    config:{0:"composition", 1:"options",},
    current:()=>{ return myjs.req.get("mode")==1 ? 1:0; },
    next:function(){ return this.current()==0 ? 1:0; },
    isCompositionApi:function(){ return this.current()==0 ? true : false; },
    switch:function(){ return `Now in ${this.config[this.current()]} api mode, switch to <a href="${myjs.req.base()}?mode=${this.next()}">${this.config[this.next()]} api</a> mode.`; },
};


// createAppのオプション
const option = {};
// composition apiとoptions apiの共通オプション
option.common = {
    created() {
        console.log("created");
        this.loading = false;
        this.mode = mode.switch();
    },
    mounted(){},
    destroyed(){},
    methods:{
        refresh(){},
    },
    computed:{},
    watch:{},
};

// compositionとoptionsに共通を割り当てる
option.composition = Object.assign({}, option.common);
option.options = Object.assign({}, option.common);

// composition apiの独自設定
option.composition.setup = function () {
    console.log("Is composition api mode");
    const loading = ref(true);
    const mode = "";
    return {
        loading,
        mode,
    }
};

// options apiの独自設定
option.options.data = function () {
    console.log("Is options api mode");
    return {
        loading : true,
        mode : "",
    }
};

option.current = mode.isCompositionApi() ? option.composition : option.options;
const app = createApp(option.current);

// Contents of v-html are inserted as plain HTML - Vue template syntax will not be processed. If you find yourself trying to compose templates using v-html, try to rethink the solution by using components instead.
// v-html の内容は、プレーンな HTML として挿入されます - Vue テンプレートの構文は処理されません。もし、v-html を使ってテンプレートを構成しようとしているのであれば、代わりにコンポーネントを使うなどして解決策を見直してみてください。
// v-html 的内容直接作为普通 HTML 插入—— Vue 模板语法是不会被解析的。如果你发现自己正打算用 v-html 来编写模板，不如重新想想怎么使用组件来代替。
app.component("tax-table", {
    data(){
        return {
            input: []
        }
    },
    template : /*html文字列*/config.template,
    watch:{
        input(after, before){ console.log("watch", after, before); },
    },
});

app.mount('#app');
</script>
</html>