<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>年金・保険・税金の計算</title>
</head>
<body>
	<h1>個人事業主の税金計算</h1>
	<div id="page">
		<div id="app"></div>
	</div>
</body>

<template id="tax-table">
	<div class="column">
		<table class="table border">
			<thead>
				<tr><th colspan=2 class="diagonal"></th><th>月間</th><th>年間</th></tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>
</template>

<template id="tax-line-0">
	<tr><th colspan=2>合計収入</th><td></td><td></td></tr>
</template>
<template id="tax-line-1">
	<tr><th rowspan=2></th><td>売上</td><td></td><td></td></tr>
</template>
<template id="tax-line-2">
	<tr><td>売上（補正）</td><td></td><td></td></tr>
</template>


<style>
* { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; }
body { margin:auto; text-align:center; background:#f9f9f9; margin-bottom:50px; }

div#page { text-align:center; font-size:9pt; margin:auto; width:900px; }
div#page > * { text-align:left; }
div#app { display: flex; }
div.column { margin: 5px; width: 50%; }

table.table { width: 100%; }
table.table.border { border-collapse: separate; border-spacing: 1px; background:#DDD; }
table.table.border > thead, table.table.border > tbody { background:#f9f9f9; }
table.table > thead > tr > th, table.table > tbody > tr > th { background:#EEE; font-weight:bold; padding:5px 10px; }
table.table > tbody > tr > td { padding:5px 10px; }
table.table > tbody > tr > td.number { text-align:right; }
.diagonal { background-image: linear-gradient(-45deg, #fff 25%, #eee 25%, #eee 50%, #fff 50%, #fff 75%, #eee 75%, #eee)!important; background-size: 4px 4px !important; }
</style>


<script type="importmap">
{
	"imports": {
		"vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
	}
}
</script>

<script type="module">
// import { createApp, ref } from 'vue'
// createApp({
//   setup() {
//     return {
//       count: ref(0)
//     }
//   }
// }).mount('#app')
</script>

<script>
window.onload=()=>{tax.render();}

var js = js || {
	type:(obj)=>{ return Object.prototype.toString.call(obj).slice(8,-1) || typeof(obj); },
	toElement:(html)=>{
		const el = document.createElement('div');
	    el.innerHTML = html;
		return el.firstElementChild;
	},
	get:(name)=>{ return document.querySelectorAll(name); },
	first:(name)=>{ return document.querySelector(name); },

	// elementへの操作関数
	handle:(name, string, method, position)=>{
		const el = js.get(name);
		if(js.type(el)=="NodeList"){
			el.forEach(function(sub){ position ? sub[method](position, string) : sub[method](string); });
		}else{
			position ? el[method](position, string) : el[method](string);
		}
		return el;
	},

	// htmlの代入
	html:(name, string)=>{ return js.handle(name, string, "setHTML"); },
	prepend:(name, string)=>{ return js.handle(name, string, "insertAdjacentHTML", "afterbegin"); },
	append:(name, string)=>{ return js.handle(name, string, "insertAdjacentHTML", "beforeend"); },
};

var tax = tax || {
	items:[
		["収入", "売上", "売上（補正用）"],
		["経費", "経費", "経費（補正用）"],
		["控除", "基礎控除", "青色申告控除", "社会保険料控除", "小規模企業共済等掛金控除", "生命保険料控除", "地震保険料控除", "配偶者控除・配偶者特別控除", "扶養控除", "医療費控除", "控除（補正用）"],
		["課税所得額", "※国民健康保険年間所得額", "※課税所得額による所得税率"],
		[],
		["税金", "住民税・均等割", "住民税・所得割", "個人事業税", "所得税", "消費税", "税金（補正用）"],
		["年金", "国民年金", "年金（補正用）"],
		["保険", "国民健康保険・平等割", "国民健康保険・均等割", "国民健康保険・所得割", "国民健康保険・後期高齢者(支援)", "国民健康保険・後期高齢者(介護)", "保険（補正用）"],
		["概要", "年金・保険・税金の合計", "手取り額"],
		[],
	],

	render:(items)=>{
		let table = "";
		(items || tax.items).forEach(function(item, i){
			if (item.length==0) {
				// テンプレートからhtmlを取得し、代入する
				let html = js.first("#tax-table").innerHTML;
				html = html.replace(/(<tbody>)(<\/tbody>)/g, "$1"+table+"$2");
				js.first("#app").insertAdjacentHTML("beforeend", html);
				table = "";
				return ;
			}

			item.forEach(function(name, ii) {
				if (ii==0) {
					table += `<tr><th colspan=2>${name}</th><td></td><td></td></tr>`;
				} else if (ii==1) {
					table += `<tr><th rowspan=${item.length-1}></th><td>${name}</td><td></td><td></td></tr>`;
				} else {
					table += `<tr><td>${name}</td><td></td><td> </td></tr>`;
				}
			});
		});
	},
};
</script>
</html>